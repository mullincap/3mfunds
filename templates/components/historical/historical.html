{% extends 'layouts/base.html' %}

{% block styles %}
<!-- Add any custom CSS here if needed -->
{% endblock %}

{% block content %}

<div class="container-fluid">

    <!-- Page Header -->
    <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
        <h1 class="page-title fw-semibold fs-18 mb-0">Historical Performance</h1>

        <div class="ms-md-1 ms-0">
            <nav>
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="/historical">Historical</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Cumulative ROI</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Hidden JSON payload for chart data -->
    <div id="hist-series" data-json='{{ chart_series|tojson }}' hidden></div>

    <!-- ========================= -->
    <!-- ROW: CUMULATIVE ROI CHART -->
    <!-- ========================= -->
    <div class="row">
        <div class="col-xxl-12">
            <div class="card custom-card">

                <div class="card-header justify-content-between">
                    <div class="card-title">
                        Total Cumulative ROI
                    </div>

                    <!-- RANGE SELECTOR BUTTONS -->
                    <div class="btn-group" role="group" aria-label="Historical ranges">


                        <button type="button" class="btn btn-primary-light hist-range-btn" data-range="1D">1D</button>
                        <button type="button" class="btn btn-primary-light hist-range-btn" data-range="3D">3D</button>
                        <button type="button" class="btn btn-primary-light hist-range-btn" data-range="1W">1W</button>
                        <button type="button" class="btn btn-primary-light hist-range-btn" data-range="1M">1M</button>
                        <button type="button" class="btn btn-primary-light hist-range-btn" data-range="3M">3M</button>
                        <button type="button" class="btn btn-primary-light hist-range-btn" data-range="6M">6M</button>
                        <button type="button" class="btn btn-primary-light hist-range-btn" data-range="1Y">1Y</button>

                    </div>
                </div>

                <div class="card-body">
                    <div id="hist-chart" style="min-height: 420px;"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- =============================== -->
    <!-- ROW: WEEKLY WEDNESDAY SNAPSHOTS -->
    <!-- =============================== -->
    <div class="row mt-4">
        <div class="col-xxl-6">
            <div class="card custom-card">
                <div class="card-header justify-content-between">
                    <div class="card-title">Weekly Snapshots (19:00 UTC)</div>
                </div>

                <div class="card-body">
                  <div class="table-responsive">
                      <table class="table table-hover table-bordered text-nowrap">
                          <thead>
                              <tr>
                                  <th scope="col">Date (UTC)</th>
                                  <th scope="col">Cumulative ROI</th>
                                  <th scope="col">WoW Change</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for row in wed_summaries %}
                              <tr>
                                  <!-- Date -->
                                  <td>{{ row.date_utc }}</td>

                                  <!-- Cumulative ROI -->
                                  <td>{{ "%.2f"|format(row.cum_roi) }}%</td>

                                  <!-- Week-over-Week Change -->
                                  <td>
                                      {% if row.wow_change is none %}
                                          â€”
                                      {% else %}
                                          {% set wow = row.wow_change %}
                                          {% if wow >= 0 %}
                                              <span class="text-success fw-semibold">
                                                  +{{ "%.2f"|format(wow) }}%
                                              </span>
                                          {% else %}
                                              <span class="text-danger fw-semibold">
                                                  {{ "%.2f"|format(wow) }}%
                                              </span>
                                          {% endif %}
                                      {% endif %}
                                  </td>
                              </tr>
                              {% else %}
                              <tr>
                                  <td colspan="3" class="text-center text-muted">
                                      No Wednesday snapshots found.
                                  </td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </div>

            </div>
        </div>
    </div>

</div>

{% endblock %}

{% block scripts %}

<!-- APEX CHARTS JS -->
<script src="{{ url_for('static', filename='assets/libs/apexcharts/apexcharts.min.js') }}"></script>

<!-- HISTORICAL PAGE JS -->
<script src="{{ url_for('static', filename='assets/js/historical.js') }}"></script>

{% endblock %}
